@page "/login"
@layout PublicLayout

@using CourseEnrollmentApp.Application.DTOs
@inject NavigationManager Nav
@inject AuthApiService AuthService
@inject TokenService TokenService

<AuthPanel Title="Login">

    <EditForm Model="_model" OnValidSubmit="Submit">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <!-- EMAIL -->
        <div class="mb-3">
            <label class="form-label">Email</label>
            <input class="form-control"
                   @bind="_model.Email"
                   type="email"
                   required />
        </div>

        <!-- PASSWORD -->
        <div class="mb-3">
            <label class="form-label">Password</label>
            <input class="form-control"
                   @bind="_model.Password"
                   type="password"
                   required />
        </div>

        <!-- LOGIN BUTTON -->
        <button type="submit" class="btn-purple w-100 auth-btn">
            Login
        </button>
    </EditForm>

    <p class="auth-footer">
        Donâ€™t have an account?
        <a href="/register" class="text-white fw-bold">Register</a>
    </p>

</AuthPanel>

@code {
    private LoginDto _model = new();

    private async Task Submit()
    {
        Console.WriteLine("LOGIN SUBMIT FIRED"); // Debug check

        var token = await AuthService.LoginAsync(_model);

        if (string.IsNullOrEmpty(token))
        {
            Console.WriteLine("LOGIN FAILED"); // Debug check
            return;
        }

        Console.WriteLine("LOGIN SUCCESS"); // Debug check
        await TokenService.SetTokenAsync(token);

        Nav.NavigateTo("/home", true);
    }
}
