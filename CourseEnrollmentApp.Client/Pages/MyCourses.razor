@page "/my-courses"
@attribute [Authorize]
@layout MainLayout

@inject MyCoursesService MyCoursesService
@inject ToastService Toasts
@inject NavigationManager Navigation

<PageHeading Text="My Courses" />

<div class="mc-container">

    <!-- SEARCH BAR -->
    <div class="mc-search-wrapper">
        <SearchBar Value="@_search" ValueChanged="OnSearch" Placeholder="Search your courses..." />
    </div>

    @if (!MyCoursesService.MyCourses.Any())
    {
        <p>You have no courses yet.</p>
    }
    else
    {
        <div class="row g-3 mc-grid">
            @foreach (var c in MyCoursesService.MyCourses.Where(MatchesSearch))
            {
                <div class="col-12 col-sm-6 col-lg-4">

                    <div class="mc-card">

                        <!-- IMAGE -->
                        <div class="mc-thumb-wrapper">
                            <img src="@c.Thumbnail" class="mc-thumb" />
                        </div>

                        <!-- BODY -->
                        <div class="mc-card-body">
                            <h6 class="fw-bold mc-card-title">@c.Title</h6>
                            <p class="small mc-card-category">@c.Category</p>

                            <div class="mc-buttons">

                                <!-- VIEW COURSE -->
                                <button class="btn-purple w-100"
                                        @onclick="() => ViewCourse(c.Id)">
                                    <i class="bi bi-play-circle me-1"></i> View Course
                                </button>

                                <!-- REMOVE COURSE -->
                                <button class="btn btn-danger w-100"
                                        @onclick="() => RemoveCourse(c.Id)">
                                    <i class="bi bi-x-circle me-1"></i> Remove
                                </button>

                            </div>
                        </div>

                    </div>

                </div>
            }
        </div>
    }
</div>

@code {
    private string _search = "";

    private void OnSearch(string value)
    {
        _search = value;
    }

    private bool MatchesSearch(CourseDto c) =>
        string.IsNullOrWhiteSpace(_search)
        || c.Title.Contains(_search, StringComparison.OrdinalIgnoreCase)
        || c.Category.Contains(_search, StringComparison.OrdinalIgnoreCase);

    void ViewCourse(int id)
    {
        Navigation.NavigateTo($"/course/{id}");
    }

    void RemoveCourse(int id)
    {
        MyCoursesService.RemoveCourse(id);
        Toasts.ShowSuccess("Course removed.");
    }
}
